<!doctype HTML public "-//W3O//DTD W3 HTML 3.0//EN">
<HTML>
<HEAD>
<TITLE>Перевод: Поляков А.В. http://www.avprog.narod.ru</TITLE>
<META name="description" content="Interrupts - 8086 Assembler">
<META name="keywords" content="interrupts, 8086, tutorial, programming, assembler tutorial, tutorial for begginers">
<META name="robots" content="nofollow">
</HEAD><BODY bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#007099" alink="#FF0000">
<TABLE WIDTH=80%>
<TR><TD>
<FONT FACE="Verdana" SIZE=3>
<FONT SIZE=+1>
<B>Уроки Ассемблера 8086 для начинающих (Часть 5)</B>
</FONT><BR><BR>
<FONT SIZE=+2><B>Библиотека общих функций - emu8086.inc</B></FONT>
<BR><BR>
<FONT SIZE=1>
Перевод: Поляков А.В. <A HREF="http://www.avprog.narod.ru">http://www.avprog.narod.ru</A>
</FONT><BR><BR><BR>
Чтобы облегчить программирование, имеются несколько общих функций, которые
можно включать в вашу программу. Чтобы использовать в вашей программе функции,
определенные в другом файле, вы должны применить директиву <B>INCLUDE</B>,
за которой следует имя файла. Компилятор автоматически найдет файл
в той же папке, где размещен файл с исходным кодом программы, а если
там этого файла не окажется, то поиск будет продолжен в папке <B>Inc</B>.

<BR><BR>
Возможно, что на сегодняшний момент вы не сможете полностью понять
содержимое <B>emu8086.inc</B> (расположенной в каталоге <B>Inc</B>),
но это не страшно, т.к. вам достаточно понять, для чего все это нужно.
<BR><BR>
Чтобы использовать какие-либо функции в <B>emu8086.inc</B>, вы должны
вписать следующую строку в вашем исходном файле:<BR><BR>

<FONT FACE="Fixedsys">
include 'emu8086.inc'
</FONT>


<BR><BR>

<HR>

<BR>
<B>emu8086.inc</B> определяет следующие <B>макросы</B>:<BR><BR>
<UL>

<LI><B>PUTC char</B> - макрос с одним параметром, печатает ASCII-символ в текущей позиции курсора.<BR><BR></LI>

<LI><B>GOTOXY col, row</B> - макрос с двумя параметрами, устанавливает позицию курсора.<BR><BR></LI>

<LI><B>PRINT string</B> - макрос с одним параметром, печатает строку.<BR><BR></LI>


<LI><B>PRINTN string</B> - макрос с одним параметром, печатает строку.
			Это тоже самое, что и PRINT, но автоматически добавляется "перевод каретки" в конце строки (аналогично процедуре Writeln в Паскале).<BR><BR></LI>

<LI><B>CURSOROFF</B> - скрывает текстовый курсор.<BR><BR></LI>

<LI><B>CURSORON</B> - показывает текстовый курсор.<BR><BR></LI>


</UL>

Чтобы использовать какой-либо из вышеописанных макросов, просто напечатайте
его имя в нужном месте вашего кода и, если необходимо, параметры. Например:<BR><BR>

<TABLE BORDER=1 CELLPADDING=10 WIDTH=50%><TR><TD>
<PRE><FONT FACE="Fixedsys">
include emu8086.inc

ORG    100h

PRINT 'Hello World!'

GOTOXY 10, 5

PUTC 65           ; 65 - это ASCII-код для буквы 'A'
PUTC 'B'

RET               ; вернуться в операционную систему.
END               ; директива для окончания компиляции.
</FONT></PRE>
</TD></TR></TABLE>

<BR><BR>
Когда компилятор обрабатывает ваш исходный код, он ищет файл <B>emu8086.inc</B>
для объявленных макросов и заменяет имя макроса реальным кодом. Вообще макросы -
это относительно небольшие участки кода, частое использование макросов
может сделать вашу программу (исполнимый файл) слишком большой (для оптимизации
размера лучше использовать процедуры).<BR><BR>

<HR>

<BR>

<B>emu8086.inc</B> также определяет следующие <B>процедуры</B>:<BR><BR>
<UL>

<LI><B>PRINT_STRING</B> - процедура для печати строки с нулевым окончанием
с текущей позиции курсора. Получает адрес строки в регистре <B>DS:SI</B>.
 Чтобы использовать эту процедуру, следует объявить: <B>DEFINE_PRINT_STRING</B>
  перед директивой <B>END</B>.<BR><BR></LI>

<LI><B>PTHIS</B> - процедура для печати строки с нулевым окончанием
с текущей позиции курсора (как и PRINT_STRING),
 но получает адрес из стека.
 Строка с нулевым окончанием должна быть определена только
 после команды CALL. Например:<BR><BR>
 <FONT FACE="Fixedsys">
 CALL PTHIS<BR>
 db 'Hello World!', 0<BR><BR>
 </FONT>
 Чтобы использовать эту процедуру, следует объявить: <B>DEFINE_PTHIS</B>
  перед директивой <B>END</B>.<BR><BR></LI>

<LI><B>GET_STRING</B> - процедура для получения строки с нулевым окончанием от
пользователя. Принятая строка записана в буфер, адрес которого
указан в <B>DS:DI</B>, размер буфера должен быть в <B>DX</B>.
Процедура завершает ввод, если нажата клавиша 'Enter'.
 Чтобы использовать эту процедуру, следует объявить: <B>DEFINE_GET_STRING</B>
  перед директивой <B>END</B>.<BR><BR></LI>

<LI><B>CLEAR_SCREEN</B> - процедура для очистки экрана (выполняет
полную прокрутку экрана и устанавливает курсор в его верхней части)
 Чтобы использовать эту процедуру, следует объявить: <B>DEFINE_CLEAR_SCREEN</B>
  перед директивой <B>END</B>.<BR><BR></LI>

<LI><B>SCAN_NUM</B> - процедура, которая получает многозначное число
 СО ЗНАКОМ с клавиатуры, и записывает результат в регистр <B>CX</B>.
 Чтобы использовать эту процедуру, следует объявить: <B>DEFINE_SCAN_NUM</B>
 перед директивой <B>END</B>.<BR><BR></LI>

<LI><B>PRINT_NUM</B> - процедура, которая печатает число со знаком, которое
 находится в регистре <B>AX</B>.
 Чтобы использовать эту процедуру, следует объявить: <B>DEFINE_PRINT_NUM</B>
 перед директивой <B>END</B>.<BR><BR></LI>

<LI><B>PRINT_NUM_UNS</B> - процедура, которая печатает число без знака
из регистра <B>AX</B>.
 Чтобы использовать эту процедуру, следует объявить: <B>DEFINE_PRINT_NUM_UNS</B>
 перед директивой <B>END</B>.<BR><BR></LI>

</UL>

<BR>
Чтобы использовать какую-либо из вышеописанных процедур, вы должны
сначала объявить функцию в нижней части вашего файла (но перед <B>END</B>!!),
а затем использовать команду <B>CALL</B>, за которой следует имя процедуры.
Пример:<BR><BR>

<TABLE BORDER=1 CELLPADDING=10 WIDTH=50%><TR><TD>
<PRE><FONT FACE="Fixedsys">
include 'emu8086.inc'

ORG    100h

LEA    SI, msg1       ; попросить ввести число
CALL   print_string   ;
CALL   scan_num       ; получить число в CX.

MOV    AX, CX         ; копировать число в AX.

; напечатать следующие строки:
CALL   pthis
DB  13, 10, 'You have entered: ', 0

CALL   print_num      ; напечатать число из AX.

RET                   ; вернуться в операционную систему.

msg1   DB  'Enter the number: ', 0

DEFINE_SCAN_NUM
DEFINE_PRINT_STRING
DEFINE_PRINT_NUM
DEFINE_PRINT_NUM_UNS  ; требуется для print_num.
DEFINE_PTHIS

END                   ; директива окончания компиляции.
</FONT></PRE>
</TD></TR></TABLE>

<BR><BR>
Сначала компилятор обрабатывает объявления (это просто обычные макросы,
которые рассматриваются до процедур). Когда компилятор получает команду <B>CALL</B>,
он заменяет имя процедуры адресом кода, где объявлена процедура. Когда выполнится команда
<B>CALL</B>, то управление будет передано процедуре. Это очень удобно:
даже если вы вызовите в вашем коде одну и ту же процедуру 100 раз, то
вы все-равно будете иметь относительно небольшой размер исполнимого файла.
Кажется сложным, не так ли? Но это не страшно. Со временем вы все это
изучите, а пока достаточно понимания только основных принципов.



<BR><BR><BR>

<HR>
<CENTER>
<A HREF="asm_tutorial_04.html"><B> &lt;&lt;&lt; Предыдущая часть &lt;&lt;&lt; </B></A>
&nbsp;&nbsp;&nbsp;&nbsp;
<A HREF="asm_tutorial_06.html"><B> >>> Следующая часть >>> </B></A>
</CENTER>
<HR>

</TD></TR>
</TABLE>

<BR>

</FONT>

</BODY>

</HTML>
