<!doctype HTML public "-//W3O//DTD W3 HTML 3.0//EN">
<HTML>
<HEAD>
<TITLE>Перевод: Поляков А.В. http://www.avprog.narod.ru</TITLE>
<META name="description" content="Simulation of I/O ports of IBM PC">
<META name="keywords" content="i/o ports, direct io, port">
<META name="robots" content="nofollow">
</HEAD>
<BODY bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#007099" alink="#FF0000">

<TABLE WIDTH=80%>
<TR><TD>

<FONT FACE="Verdana" SIZE=3>

<FONT SIZE=+2>
<B>Порты ввода/вывода</B>
</FONT><BR><BR>
<FONT SIZE=1>
Перевод: Поляков А.В. <A HREF="http://www.avprog.narod.ru">http://www.avprog.narod.ru</A>
</FONT><BR><BR><BR>
Эмулятор не воспроизводит каие-либо оригинальные порты ввода/вывода.
Вместо этого он имеет виртуальные устройства, которые могут быть доступны через
команды IN/OUT.
<BR><BR>


<HR>

<BR>
<B>Пользовательские устройства ввода/вывода.</B>
<BR><BR>

"<I>Emu8086</I>" поддерживает дополнительные устройства, которые
могут быть созданы сторонними организациями. Устройство должно быть
написано на каком-либо языке программирования, например: Visual Basic,
VC++, Delphi. Более подробную информацию и примеры исходного кода
ищите в папке <B>DEVICES</B>.

<BR><BR>

Для пользовательских устройств зарезервированы адреса: 
от 00000Fh до 0FFFFh (от 15 до 65535).
Порт 100 соответствует байту 100 в файле "<B>EmuPort.io</B>", 
порт 101 - байту 101 и т.п...<BR>
(отсчет ведется от нуля).
<BR>
Файл "<B>EmuPort.io</B>" размещен в каталоге Windows "<B>Temp</B>"
(может быть получен с помощью API функции <I>GetTempPath()</I>).
<BR><BR>
Я буду рад включить разработанные вами устройства в следующий
выпуск "<I>Emu8086</I>". Если вы решите поделится своим устройством
с другими разработчиками - пожалуйста, вышлите его исходный код <A HREF="mailto:info@emu8086.com">нам</A>!

<BR><BR>

<HR>

<BR><BR>
Устройства, которые доступны через меню эмулятора "<B>Virtual Devices</B>".

<BR><BR>

<UL>

<LI><B>Светофор</B> - Порт 4 (слово)<BR><BR>
Светофор управляется пересылкой данных через порт ввода/вывода 4.<BR>
Имеются 12 ламп: 4 зеленых, 4 желтых и 4 красных.<BR><BR>
Вы можете управлять состоянием каждой лампы, устанавливая эти биты:<BR><BR>
<B>1</B> - лампа включена.<BR>
<B>0</B> - лампа выключена.<BR><BR>
Используются только 12 младших битов слова (от 0 до 11),
последние биты (от 12 до 15) не используются
Пример:<BR><BR>
<FONT FACE="Fixedsys">
MOV AX, 0000001011110100b<BR>
OUT 4, AX<BR><BR>
</FONT>

<IMG SRC="traffic.gif" WIDTH=233 HEIGHT=276>

<BR><BR>
Мы используем в подписях к рисунку шестнадцатиричные цифры желтого цвета (для компактности).
Ниже приведена таблица преобразования шестнадцатиричных цифр в десятичные:<BR>
<PRE><FONT FACE="Fixedsys">Шест. - Десят.

A   -   10
B   -   11
C   -   12    (не используется)
D   -   13    (не используется)
E   -   14    (не используется)
F   -   15    (не используется)</FONT></PRE><BR>

Первый операнд для команды <B>OUT</B> - это номер порта (<B>4</B>),
второй операнд - это слово (<B>AX</B>), которое записывается в порт.
Первый операнд должен быть непосредственным значением в диапазоне
(0..255) или регистром <B>DX</B>. Второй операнд должен быть
только регистром <B>AX</B> или <B>AL</B>.

<BR><BR>
См. также "<B>traffic_lights.asm</B>" в Samples.

<BR><BR>

<HR>

<BR>
Если нужно, вы можете прочитать данные из порта, используя команду
<B>IN</B>, например:<BR>
<BR>
<FONT FACE="Fixedsys">
IN AX, 4<BR><BR>
</FONT>
Первый операнд в команде <B>IN</B> (<B>AX</B>) получает значение из
порта, второй операнд (<B>4</B>) - это номер порта. Первый операнд
должен быть только регистром <B>AX</B> или <B>AL</B>. Второй операнд
должен быть непосредственным значением от 0 до 255 или регистром <B>DX</B>.
<BR><BR>
<HR>
<BR><BR>
</LI>


<LI><B>Шаговый двигатель</B> - Порт 7 (байт)<BR><BR>
Шаговый двигатель управляется посылкой данных в порт ввода-вывода 7.<BR><BR>
Шаговый двигатель - это электромотор, который может точно управляться сигналами
от компьютера.<BR><BR>
Двигатель поворачивается на определенный угол каждый раз, когда
он принимает сигнал. Изменяя соотношение между продолжительностью
импульсов и пауз, можно заставить двигатель вращаться с разной скоростью
или повернуть ротор на заданный угол и сотановить двигатель.<BR><BR>
В основе 3-х фазного шагового двигателя лежит конструкция из 3-х
магнитов, управляемых битами 0, 1 и 2. Остальные биты (2..7) не используются.
<BR><BR>
Когда магнит работает, он становится красным. Стрелка в левом
верхнем углу показывает направление последнего движения мотора. Зеленая
линия здесь только для того, чтобы видеть реальное вращение.

<BR><BR>

<IMG SRC="stepper.gif" WIDTH=237 HEIGHT=215>

<BR><BR>
Например, код, приведенный ниже, позволяет выполнить три полушага по
часовой стрелке:<BR><BR>
<FONT FACE="Fixedsys">
MOV AL, 001b   ; инициализация.<BR>
OUT 7, AL<BR><BR>

MOV AL, 011b   ; полушаг 1.<BR>
OUT 7, AL<BR><BR>

MOV AL, 010b   ; полушаг 2.<BR>
OUT 7, AL<BR><BR>

MOV AL, 110b   ; полушаг 3.<BR>
OUT 7, AL<BR><BR>
</FONT>
Если вы когда-либо играли с магнитами, вы поймете, как это работает.
Попробуйте поэксперементировать, или см. "<B>stepper_motor.asm</B>" в Samples.

<BR><BR>
Если потребуется, вы должны прочитать данные из порта, используя
команду <B>IN</B>, например:<BR>
<BR>
<FONT FACE="Fixedsys">
IN AL, 7<BR><BR>
</FONT>

<HR>

<BR><BR>

</LI>


<LI><B>Робот</B> - Порт 9 (3 байта)<BR><BR>


<IMG SRC="robot.gif" WIDTH=530 HEIGHT=352>

<BR><BR>
Робот управляется посылкой данных в порт ввода-вывода 9.<BR>
<BR><BR>
Первый байт (Порт 9) - это <B>Командный регистр</B>. Запись данных в этот порт
заставляет робота выполнять определенные действия. Поддерживаются
следующие значения:<BR><BR>
<TABLE BORDER=1 CELLPADDING=7>
<TR>
<TD BGCOLOR=YELLOW>Десятичное значение</TD><TD BGCOLOR=YELLOW>Двоичное значение</TD><TD BGCOLOR=YELLOW>Действие</TD>
</TR>
<TR>
<TD ALIGN=CENTER VALIGN=CENTER><B>0</B> </TD> <TD>00000000</TD> <TD> Бездействие.</TD>
</TR>
<TD ALIGN=CENTER VALIGN=CENTER><B>1</B> </TD> <TD>00000001</TD> <TD> Движение вперед.</TD>
</TR>
<TR>
<TD ALIGN=CENTER VALIGN=CENTER><B>2</B> </TD> <TD>00000010</TD> <TD> Поворот налево.</TD>
</TR>
<TR>
<TD ALIGN=CENTER VALIGN=CENTER><B>3</B> </TD> <TD>00000011</TD> <TD> Поворот направо.</TD>
</TR>
<TR>
<TD ALIGN=CENTER VALIGN=CENTER><B>4</B> </TD> <TD>00000100</TD> <TD>Исследование.
           Исследует объект перед собой, используя датчик. Если робот
           завершает задачу, результат устанавливается в <B>Регистр данных</B>
           и <B>Бит #0</B> <B>Регистра состояния</B>
           установлен в <B>1</B>.</TD>
</TR>

<TR>
<TD ALIGN=CENTER VALIGN=CENTER><B>5</B> </TD> <TD>00000101</TD> <TD> Включение лампы.</TD>
</TR>

<TR>
<TD ALIGN=CENTER VALIGN=CENTER><B>6</B> </TD> <TD>00000110</TD> <TD> Выключение лампы.</TD>
</TR>

</TABLE>

<BR><BR>
Второй байт (порт 10) - это <B>Регистр данных</B>. Этот регистр
устанавливается после завершения задачи командой <B>Исследование</B>:<BR><BR>

<TABLE BORDER=1 CELLPADDING=7>
<TR>
<TD BGCOLOR=YELLOW>Десятичное значение</TD><TD BGCOLOR=YELLOW>Двоичное значение</TD><TD BGCOLOR=YELLOW>Значение</TD>
</TR>
<TR>
<TD ALIGN=CENTER VALIGN=CENTER><B>255</B></TD>  <TD>11111111</TD> <TD>Стена</TD>
</TR>
<TR>
<TD ALIGN=CENTER VALIGN=CENTER><B>0</B></TD>  <TD>00000000</TD> <TD>Ничего</TD>
</TR>
<TR>
<TD ALIGN=CENTER VALIGN=CENTER><B>7</B></TD>  <TD>00000111</TD> <TD>Лампа включена</TD>
</TR>
<TR>
<TD ALIGN=CENTER VALIGN=CENTER><B>8</B></TD>  <TD>00001000</TD> <TD>Лампа выключена</TD>
</TR>
</TABLE>

<BR><BR>
Третий байт (порт 11) - это <B>Регистр состояния</B>. Чтение данных из
этого порта позволяет определить состояние робота. Каждый бит имеет
определенное свойство:<BR><BR>
<TABLE BORDER=1 CELLPADDING=7>
<TR>
<TD BGCOLOR=YELLOW><NOBR>Номер бита</NOBR></TD><TD BGCOLOR=YELLOW>Описание</TD>
</TR>
<TR>
<TD><B>Бит #0 </B> </TD><TD>  <B>ноль</B>, если в <B>Регистре данных</B> нет новых данных,
             <B>единица</B>, если в <B>Регистре данных</B> новые (не прочитанные) данные.</TD>
</TR>
<TR>
<TD><B>Бит #1 </B> </TD><TD>  <B>ноль</B>, если робот готов принять следующую команду,
      <B>единица</B>, если робот занят выполнением текущей задачи.</TD>
</TR>
<TR>
<TD><B>Бит #2 </B> </TD><TD>  <B>ноль</B>, если нет ошибок при выполнении последней команды,
           <B>единица</B>, если случилась ошибка при выполнении команды
           (когда робот не может завершить задачу: движение, поворот, исследование, 
           включение или выключение лампы).</TD>
</TR>
</TABLE>

<BR><BR>

Пример:<BR>
<PRE><FONT FACE="Fixedsys">
MOV AL, 1  ; движение вперед.
OUT 9, AL  ;

MOV AL, 3  ; поворот вправо.
OUT 9, AL  ;

MOV AL, 1  ; движение вперед.
OUT 9, AL  ;

MOV AL, 2  ; поворот влево.
OUT 9, AL  ;

MOV AL, 1  ; движение вперед.
OUT 9, AL  ;
</FONT></PRE>

<BR>
Примите во внимание, что робот - это механическое создание, поэтому
для выполнения команд ему требуется какое-то время. Вы должны всегда проверять бит#1
<B>Регистра состояния</B>, прежде чем записать данные в порт 9, иначе
робот откажется выполнять вашу команду и вы увидите надпись "<FONT COLOR=red><B>BUSY!</B></FONT>".
См. "<B>robot.asm</B>" в Samples.


<BR><BR>

<HR>

<BR>

<B>Создание пользовательсокой <I>Карты мира</I> робота</B>

<BR><BR>
Вы можете создать любую карту для робота, используя панель инструментов (см. рис.).<BR><BR>
Если вы выберите <B>робота</B> и разместите его над существующим 
<B>роботом</B>, он повернется на 90 градусов по часовой стрелке. Чтобы передвинуть
робота на другое место, щелкните по нему, затем щелкните в нужном месте карты.<BR><BR>

Если вы выберите <B>лампу</B> и разместите ее над <B>включенной лампой</B>,
то <B>лампа</B> будет <B>выключена</B>, если <B>лампа</B> уже
<B>выключена</B>, то она будет <B>удалена</B>. <BR><BR>

Если разместить <B>стену</B> над существующей <B>стеной</B>, то стена
будет <B>удалена</B>.
<BR><BR>
Данная версия работает только с одним роботом. Если вы забудете
разместить робота на карте, то он будет помещен туда автоматически
в случайном месте.
<BR><BR>
Карта автоматически сохраняется после выхода.

<BR><BR>
Щелчок правой кнопкой по карте вызовет меню, которое позволяет
<NOBR>включать/выключать</NOBR> все лампы.
<BR><BR>

<HR>

</LI>


</UL>



</FONT>

</TD></TR>
</TABLE>



<BR>



</BODY>

</HTML>
