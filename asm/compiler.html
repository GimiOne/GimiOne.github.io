<!doctype HTML public "-//W3O//DTD W3 HTML 3.0//EN">
<HTML>
<HEAD>
<TITLE>Перевод: Поляков А.В. http://www.avprog.narod.ru</TITLE>
<META name="description" content="What is an assembly language?">
<META name="keywords" content="emu8086, 8086, tutorial, programming, assembler tutorial, tutorial for begginers">
<META name="robots" content="nofollow">
</HEAD>

<BODY bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#007099" alink="#FF0000">

<TABLE WIDTH=80%>
<TR><TD>
<FONT FACE="Verdana" SIZE=3>
<FONT SIZE=+1>
<B>Компиляция кода Ассемблера</B>
</FONT><BR><BR>
<FONT SIZE=1>
Перевод: Поляков А.В. <A HREF="http://www.avprog.narod.ru">http://www.avprog.narod.ru</A>
</FONT><BR><BR><BR>

<IMG SRC="compile01.gif" WIDTH=593 HEIGHT=289><BR><BR><BR>

Напечатайте ваш код внутри текстовой области и щелкните кнопку <B>[Compile]</B>.
Вас спросят, где сохранить откомпилированный файл. После завершения компиляции вы можете
щелкнуть кнопку <B>[Emulate]</B> для загрузки откомпилированного файла
в эмулятор.<BR><BR>

<HR>
<B>Директивы, определяющие тип исполнимого файла:</B><BR><BR>
<PRE>
<FONT FACE="Fixedsys">
	     #MAKE_COM#
	     #MAKE_BIN#
	     #MAKE_BOOT#
	     #MAKE_EXE#</FONT></PRE>
Вы можете вставить эти директивы в исходный код для определения
нужного вам типа исполнимого файла. В том случае, если компилятор не найдет ни одной
из этих директив, он спросит у вас <I>тип файла</I> перед его созданием.
<HR>

<BR>
<B>Описание типов исполнимых файлов:</B>
<BR><BR>
<UL>
	<LI>
	<B>#MAKE_COM#</B> - самый старый и самый простой формат исполнимого
	файла. Такие файлы загружаются с префиксом 100h (256 байтов).
	Выберите <B>СОМ Template</B> из меню <B>New</B>, если вы планируете
	компилировать COM-файл. Директива компилятора <B>ORG 100h</B>
	должна быть добавлена перед кодом. Выполнение всегда начинается
	с первого байта файла. Поддерживается командной строкой DOS и Windows.
	<BR><BR><BR><BR>
    </LI>

	<LI>
	<B>#MAKE_EXE#</B> - более "продвинутый" формат исполнимого файла.
	Не ограничены размер и количество сегментов. Сегмент стека
	должен быть определен в программе. Вы можете выбрать <B>EXE Template</B>
	из меню <B>New</B> для создания простой ЕХЕ-программы с определенными
	сегментмами Данных, Стека и Кода. Точка входа (где начинается выполнение)
	определяется программистом. Поддерживается командной строкой DOS и Windows.
	<BR><BR><BR><BR>
    </LI>

	<LI>
	<B>#MAKE_BIN#</B> - простой исполнимый файл. Вы можете определить
	значения всех регистров, сегмент и смещение для области памяти,
	куда этот файл будет загружен. Если загрузить файл "<B>MY.BIN</B>"
	в эмулятор, он будет виден для файла "<B>MY.BINF</B>" и
	загрузится файл "<B>MY.BIN</B>" в местоположение, определенное
	в файле "<B>MY.BINF</B>". Регистры также установятся с учетом
	информации из этого файла (откройте этот файл в редакторе для
	изменения или изучения). В том случае, если эмулятор не найдет
	файл "<B>MY.BINF</B>", будет использоваться текущие значения
	регистров и файл "<B>MY.BIN</B>" загрузится в текущий <B>CS:IP</B>.
	<BR>Выполнение начинается со значения в <B>CS:IP</B>.<BR>
	Этот тип файла уникален для <I>Emu8086</I>.
	<BR><BR>

   <!-- 1.25 -->

    Файл <B>".BINF</B> создается автоматически компилятором, если он находит
    директиву <B>#MAKE_BIN#</B>.<BR>
    <FONT COLOR=RED>ПРЕДУПРЕЖДЕНИЕ! если файл ".binf" существует, то он будет перезаписан!</FONT><BR><BR>
    <TABLE BORDER=1 CELLPADDING=10 WIDTH=80%><TR><TD>
    <PRE><FONT FACE="Fixedsys">
	#LOAD_SEGMENT=1234#
	#LOAD_OFFSET=0000#
	#AL=12#
	#AH=34#
	#BH=00#
	#BL=00#
	#CH=00#
	#CL=00#
	#DH=00#
	#DL=00#
	#DS=0000#
	#ES=0000#
	#SI=0000#
	#DI=0000#
	#BP=0000#
	#CS=1234#
	#IP=0000#
	#SS=0000#
	#SP=0000#</FONT></PRE>
	</TABLE>
   <!-- end -->
<BR>
	Значения должны быть шестнадцатиричными!<BR><BR>

	Если эти значения не определены, то они устанавливаются по умолчанию:<BR>
	<FONT COLOR=GREEN>
	<B>LOAD_SEGMENT = 0100</B><BR>
	<B>LOAD_OFFSET  = 0000</B><BR>
	<B>CS = ES = SS = DS = 0100</B><BR>
	<B>IP = 0000</B><BR>
	</FONT>
 <BR>

	Если <B>LOAD_SEGMENT</B> и <B>LOAD_OFFSET</B> не определены, то
	используются значения <B>CS</B> и <B>IP</B>, и наоборот.
	<BR><BR>

<!--
<HR>
<BR>

	Format of a typical <B>".BINF</B>" file:<BR><BR>
	<TABLE BORDER=1 CELLPADDING=10 WIDTH=80%><TR><TD>
	<PRE>
	<FONT FACE="Fixedsys">
	8000         ; Load to segment.
	0000         ; Load to offset.
	55           ;   AL
	66           ;   AH
	77           ;   BL
	88           ;   BH
	99           ;   CL
	AA           ;   CH
	BB           ;   DL
	CC           ;   DH
	DDEE         ;   DS
	ABCD         ;   ES
	EF12         ;   SI
	3456         ;   DI
	7890         ;   BP
	8000         ;   CS
	0000         ;   IP
	C123         ;   SS
	D123         ;   SP </FONT>	</PRE>
	</TD></TR></TABLE>
	<BR>
	As you see first goes a number in hexadecimal form and then a comment.<BR>
	Comments are added just to make some order, when emulator loads a <B>BINF</B>
	file it does not care about comments it just looks for a values on specific
	lines, so line order is very important.

<HR>
-->

	<BR>
	Если значение <B>Load to offset</B> не равно нулю (0000), то <B>ORG ????h</B> должна
	быть добавлена в файл <B>.BIN</B>, где <B>????h</B> - это <I>смещение для загрузки</I>.
	Это должно быть сделано для того, чтобы компилятор мог вычислить
	правильные адреса.
	<BR><BR>

   <BR><BR>
    </LI>

	<LI>
	<B>#MAKE_BOOT#</B> - эта директива копирует первую дорожку дискеты (загрузочный сектор).
	<BR>
     Вы можете записать загрузочный сектор виртуального дисковода
     (FLOPPY_0) через меню эмулятора:<BR>
     <B>[Virtual Drive] -> [Write 512 bytes at 7C00 to Boot Sector]</B>
     <BR>
     Сначала вы должны откомпилировать "<B>.boot</B>"-файл, а затем
     загрузить его в эмулятор (см. "<B>micro-os_loader.asm</B>" и "<B>micro-os_kernel.asm</B>"
     в разделе "Samples").

     <BR><BR>
     Затем выберите в меню <B>[Virtual Drive] -> [Boot from Floppy]</B>, чтобы загрузить
     эмулятор с виртуального дисковода.

     <BR><BR>
     Затем, если вам любопытно, вы можете записать виртуальную дискету
     на реальную дискету и загрузить с нее ваш компьютер. Я рекомендую
     использовать "RawWrite for Windows" с:
     <A HREF="http://uranus.it.swin.edu.au/~jn/linux/rawwrite.htm">
     http://uranus.it.swin.edu.au/~jn/linux/rawwrite.htm</A><BR>
     (учтите, что "<B>micro-os_loader.asm</B>" не использует
     MS-DOS-совместимый загрузочный сектор, так что лучше использовать
     чистую дискету, хотя она должна быть отформатирована IBM (MS-DOS)).
	<BR>
    Директива компилятора
	<B>ORG 7C00h</B> должна быть добавлена перед кодом, если компьютер
	начинает загружаться с первой дорожки дискеты в адрес 0000:7C00.
	<BR>
	Размер <B>.BOOT</B>-файла должен быть менее 512 байтов
	(ограничен размером сектора дискеты).
	<BR>
	Выполнение всегда начинается с первого байта файла. Этот тип файла
	уникален для эмулятора <I>Emu8086</I>.
	<BR><BR>
    </LI>

</UL>

<HR>

<BR>
<B>Обработка ошибок</B>

<BR><BR>
Компилятор выводит отчет об ошибках в отдельном окне:
<BR><BR>

<IMG SRC="compile03.gif" WIDTH=511 HEIGHT=403>

<BR><BR>

<FONT FACE="Fixedsys">MOV DS, 100</FONT> - это недопустимая команда,
потому что в сегментный регистр нельзя устанавливать непосредственное
значение - должны использоваться регистры общего назначения:<BR>
<FONT FACE="Fixedsys">
MOV AX, 100<BR>
MOV DS, AX
</FONT>

<BR><BR>

<FONT FACE="Fixedsys">MOV AL, 300</FONT> - это недопустимая команда, т.к.
регистр <B>AL</B> имеет только 8 битов, и его максимальное значение
255 (или 11111111b), а минимальное -128.<BR>

<BR><BR>

<HR>

<BR>
Компилятор делает несколько проходов перед генерацией правильного
машинного кода. Если он находит ошибку и не выполняет требуемое
количество проходов, он может выдать неправильное сообщение об
ошибке. Например:

<PRE><FONT FACE="Fixedsys">#make_COM#
ORG 100h

MOV AX, 0
MOV CX, 5
m1: INC AX
LOOP m1                ; это не настоящая ошибка!

MOV AL, 0FFFFh         ; ошибка здесь.

RET</FONT></PRE>

<FONT FACE="MS Sans Serif" SIZE=2>
Список генерируемых ошибок:<BR>
(7) Condition Jump out of range (Условие перехода за пределами диапазона)!: LOOP m1<BR>
(9) Wrong parameters (Неправильнве параметры): MOV  AL, 0FFFFh<BR>
(9) Operands do not match (Операнды не соответствуют): Second operand is over 8 bits (Второй операнд более 8 битов)! <BR>
</FONT>

<BR>
Первое сообщение (7) - неправильное. Компилятор не закончил вычисление
смещений для меток, поэтому он думает, что смещение метки <B>m1</B>
- это <B>0000</B>. Этот адрес лежит за пределами диапазона, т.к. мы
начинаем со смещения <B>100h</B>.

<BR><BR>

Внесите исправления в эту строку: <B>MOV AL, 0FFFFh</B>
(AL не может содержать значение <B>0FFFFh</B>).
Это устранит обе ошибки!
Например:
<BR><BR>
<PRE><FONT FACE="Fixedsys">#make_COM#
ORG 100h

MOV AX, 0
MOV CX, 5
m1: INC AX
LOOP m1                ; тот же самый код без ошибки!

MOV AL, 0FFh           ; все!

RET</FONT></PRE>

<HR>

<BR>
При сохранении компилируемого файла, компилятор также сохраняет 2 других
файла, которые используются эмулятором для отображения фактического
исходного кода при его исполнении и выборе соответствующей строки.

<UL>

<LI> <B>*.~asm</B> - этот файл содержит оригинальный исходный код, который
был использован для создания исполнимого файла.<BR><BR></LI>

<LI> <B>*.debug</B> - этот файл содержит информацию, которая позволяет
эмулятору выбирать строки оригинального исходного кода во время
выполнения машинного кода.<BR><BR></LI>

<LI> <B>*.symbol</B> - Таблица символов. Она содержит информацию, которая
позволяет отображать окно "Variables" (Переменные). Это текстовый файл,
так что вы можете посмотреть его из текстового редактора.
						<BR><BR></LI>

<LI> <B>*.binf</B> - этот файл содержит информацию, которая используется эмулятором
для загрузки BIN-файла в указанное местоположение, и установки значений
регистров предшествующих выполнению (создается только в том случае, если
исполнимый файл - это BIN-файл).
						<BR><BR></LI>


</UL>

<HR>

</FONT>

</TD></TR>
</TABLE>

<BR>



</BODY>

</HTML>
