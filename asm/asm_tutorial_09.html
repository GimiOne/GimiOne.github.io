<!doctype HTML public "-//W3O//DTD W3 HTML 3.0//EN">
<HTML>
<HEAD>
<TITLE>Перевод: Поляков А.В. http://www.avprog.narod.ru</TITLE>
<META name="description" content="Interrupts - 8086 Assembler">
<META name="keywords" content="interrupts, 8086, tutorial, programming, assembler tutorial, tutorial for begginers">
<META name="robots" content="nofollow">
</HEAD><BODY bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#007099" alink="#FF0000">
<TABLE WIDTH=80%>
<TR><TD>
<FONT FACE="Verdana" SIZE=3>
<FONT SIZE=+1>
<B>Уроки Ассемблера 8086 для начинающих (Часть 9)</B>
</FONT><BR><BR>
<FONT SIZE=+2><B>Стек</B></FONT>
<BR><BR>
<FONT SIZE=1>
Перевод: Поляков А.В. <A HREF="http://www.avprog.narod.ru">http://www.avprog.narod.ru</A>
</FONT><BR><BR><BR>

Стек - это область памяти для хранения временных данных. Стек используется
командой <B>CALL</B> для хранения адреса, чтобы программа
могла вернуться к тому месту, откуда была вызвана процедура. Команда
<B>RET</B> получает этот адрес из стека и возвращает управление
по этому смещению. то же самое происходит, когда команда <B>INT</B>
вызывает прерывание, она записывает в стек регистр флагов,
сегмент и смещение кода. Команда <B>IRET</B> используется для
возвращения после вызова прерывания.

<BR><BR>
Вы можете использовать стек для хранения любых данных. Для работы
со стеком имеются две команды:<BR><BR>

<B>PUSH</B> - записывает 16-ти битовое значение в стек.<BR><BR>

<B>POP</B> - получает 16-ти битовое значение из стека.<BR><BR>

<TABLE BORDER=1 CELLPADDING=10 WIDTH=100%><TR><TD>

Синтаксис для команды <B>PUSH</B>:<BR><BR>
<BLOCKQUOTE>
<FONT FACE="Fixedsys">
	PUSH REG<BR>
	PUSH SREG<BR>
	PUSH memory<BR>
	PUSH immediate<BR>
</FONT>
</BLOCKQUOTE>

<B>REG</B>: AX, BX, CX, DX, DI, SI, BP, SP.<BR><BR>
<B>SREG</B>: DS, ES, SS, CS.<BR><BR>
<B>memory</B>: [BX], [BX+SI+7], 16-ти битовая переменная и т.п...<BR><BR>
<B>immediate</B>: 5, -24, 3Fh, 10001101b, и т.п...<BR><BR>

</TD></TR></TABLE>

<BR>

<TABLE BORDER=1 CELLPADDING=10 WIDTH=100%><TR><TD>

Синтаксис для команды <B>POP</B>:<BR><BR>
<BLOCKQUOTE>
<FONT FACE="Fixedsys">
	POP REG<BR>
	POP SREG<BR>
	POP memory<BR>
</FONT>
</BLOCKQUOTE>

<B>REG</B>: AX, BX, CX, DX, DI, SI, BP, SP.<BR><BR>
<B>SREG</B>: DS, ES, SS, (кроме CS).<BR><BR>
<B>memory</B>: [BX], [BX+SI+7], 16-ти битовая переменная и т.п...<BR><BR>

</TD></TR></TABLE>

<BR><BR>
Примечания:
<UL>
<LI>Команды <B>PUSH</B> и <B>POP</B> работают только с 16-ти битовыми значениями!<BR><BR></LI>

<LI>Примечание: <B>PUSH immediate</B> работает только на процессорах 80186 и выше!</LI>

</UL>

<BR><BR>
Стек использует алгоритм <B>LIFO</B> (Last In First Out - Последним пришел - первым ушел),
это значит, что если мы поместим эти значения одно за другим в стек:<BR><BR>
<B>1, 2, 3, 4, 5</B><BR><BR>
то первым значением, которое мы можем получить из стека, будет <B>5</B>,
затем <B>4</B>, <B>3</B>, <B>2</B> и только потом <B>1</B>.
<BR><BR>

<IMG SRC="stack.gif" WIDTH=224 HEIGHT=253>

<BR><BR>

Очень важно применять равное количество команд <B>PUSH</B> и <B>POP</B>,
иначе стек может быть нарушен и невозможно будет вернуться в операционную
систему. Как вы уже знаете, мы используем команду <B>RET</B> для возвращения в операционную
систему. Когда программа запускается, ее адрес записывается в стек
(обычно это 0000h).

<BR><BR>

Команды <B>PUSH</B> и <B>POP</B> чрезвычайно полезны, т.к. для хранения
данных обычно недостаточно только регистров. Вот выход из ситуации:
<UL>
<LI>Записать значение регистра в стек (используя <B>PUSH</B>).<BR><BR></LI>
<LI>Использовать этот регистр в своих целях.<BR><BR></LI>
<LI>Восстановить предыдущее значение регистра из стека (используя <B>POP</B>).</LI>
</UL>

<BR>
Пример:
<BR><BR>

<TABLE BORDER=1 CELLPADDING=10 WIDTH=50%><TR><TD>
<PRE><FONT FACE="Fixedsys">
ORG    100h

MOV    AX, 1234h
PUSH   AX          ; записать значение из AX в стек.

MOV    AX, 5678h   ; изменить значение регистра AX.

POP    AX          ; восстановить первоначальное значение AX.

RET

END</FONT></PRE>
</TD></TR></TABLE>

<BR><BR>
Стек можно также использовать для того, чтобы поменять местами
значения в регистрах:<BR><BR>


<TABLE BORDER=1 CELLPADDING=10 WIDTH=50%><TR><TD>
<PRE><FONT FACE="Fixedsys">
ORG    100h

MOV    AX, 1212h   ; записать в АХ число 1212h.
MOV    BX, 3434h   ; записать в ВХ число 3434h.


PUSH   AX          ; записать значение AX в стек.
PUSH   BX          ; записать значение ВX в стек.

POP    AX          ; установить в AX значение BX.
POP    BX          ; установить в ВX значение АX.

RET

END</FONT></PRE>
</TD></TR></TABLE>
<BR>
Обмен данными происходит потому, что стек использует алгоритм
<B>LIFO</B> (Последним пришел - первым вышел), поэтому когда мы
помещаем в стек число <B>1212h</B>, а затем - <B>3434h</B>, то
при обращении к стеку мы сначала получим число <B>3434h</B>, и только
потом -  <B>1212h</B>.

<BR><BR>

<HR>

<BR>
Область памяти стека устанавливается при помощи регистров
<B>SS</B> (Stack Segment - сегмент стека) и <B>SP</B> (Stack
Pointer - указатель стека). Обычно операционная система устанавливает
значения этих регистров на начало программы.

<BR><BR>

Команда "<B>PUSH <I>источник</I></B>" делает следующее:<BR>
<UL>
<LI>Вычитает <B>2</B> из регистра <B>SP</B>.<BR><BR></LI>
<LI>Записывает значение <B><I>источника</I></B> по адресу <B>SS:SP</B>.</LI>
</UL>

<BR>

Команда "<B>POP <I>приемник</I></B>" делает следующее:<BR>
<UL>
<LI>Записывает данные, размещенные по адресу <B>SS:SP</B> в <B><I>приемник</I></B>.<BR><BR></LI>
<LI>Увеличивает на <B>2</B> значение регистра <B>SP</B>.</LI>
</UL>

<BR>
Текущий адрес указателя в <B>SS:SP</B> называется <B>вершиной стека</B>.
<BR><BR>

Для <B>COM</B>-файлов сегмент стека - это обычно и сегмент кода, а
указатель стека установлен в значение <B>0FFFEh</B>.
По адресу <B>SS:0FFFEh</B> записывается адрес возврата для команды
<B>RET</B>, которая выполняется в конце программы.

<BR><BR>
Вы можете наблюдать за работой стека, щелкнув по кнопке [<B>Stack</B>] в
окне эмулятора. Вершина стека отмечена знаком "<B>&lt;</B>".


<BR><BR><BR>

<HR>
<CENTER>
<A HREF="asm_tutorial_08.html"><B> &lt;&lt;&lt; Предыдущая часть &lt;&lt;&lt; </B></A>
&nbsp;&nbsp;&nbsp;&nbsp;
<A HREF="asm_tutorial_10.html"><B> >>> Следующая часть >>> </B></A>
</CENTER>
<HR>



<BR>

</FONT>



</TD></TR>
</TABLE>


</BODY>

</HTML>
